# üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –¥–ª—è Python Code Check System

## üìã –û–±–∑–æ—Ä

Nginx –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ reverse proxy –¥–ª—è Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è:
- –°—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞–∑–¥–∞—á—É —Ñ–∞–π–ª–æ–≤
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏
- SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—é
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã:
scp nginx.conf setup-nginx.sh root@158.160.28.235:/root/
```

### 2. –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
sudo bash setup-nginx.sh
```

## üîß –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx

```bash
sudo apt update
sudo apt install -y nginx
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo cp nginx.conf /etc/nginx/sites-available/python-code-check-system

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–∞–π—Ç
sudo ln -s /etc/nginx/sites-available/python-code-check-system /etc/nginx/sites-enabled/

# –£–¥–∞–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å–∞–π—Ç
sudo rm -f /etc/nginx/sites-enabled/default
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot

```bash
sudo apt install -y certbot python3-certbot-nginx
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ example.com –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
sudo certbot --nginx -d example.com
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
sudo crontab -e
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
0 12 * * * /usr/bin/certbot renew --quiet
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞
tail -f /var/log/nginx/python-code-check-system.access.log

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
tail -f /var/log/nginx/python-code-check-system.error.log

# –í—Å–µ –ª–æ–≥–∏ Nginx
journalctl -u nginx -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –°—Ç–∞—Ç—É—Å Nginx
systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart nginx
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –†–∞–∑—Ä–µ—à–∞–µ–º HTTP –∏ HTTPS
sudo ufw allow 'Nginx Full'
sudo ufw allow OpenSSH
sudo ufw enable
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–í —Ñ–∞–π–ª–µ `/etc/nginx/sites-available/python-code-check-system` —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã:
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–∏ Nginx

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Nginx

### 1. –û–±–Ω–æ–≤–∏—Ç–µ ALLOWED_HOSTS

–í –≤–∞—à–µ–º `.env` —Ñ–∞–π–ª–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –∏–ª–∏ IP –≤ ALLOWED_HOSTS
echo "ALLOWED_HOSTS=localhost,127.0.0.1,0.0.0.0,yourdomain.com" >> .env
```

### 2. –°–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã

```bash
# –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker compose exec server python manage.py collectstatic --noinput
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Django

```bash
docker compose restart server
```

## üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **HTTP –¥–æ—Å—Ç—É–ø**: http://158.160.28.235:8000
2. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã**: http://158.160.28.235:8000/static/
3. **–õ–æ–≥–∏ Nginx**: `tail -f /var/log/nginx/python-code-check-system.access.log`

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ 502 Bad Gateway

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Django –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000
docker compose ps
netstat -tlnp | grep :8000
```

### –û—à–∏–±–∫–∞ 404 –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–π–ª–∞–º
ls -la /umschool/static/
sudo chown -R www-data:www-data /umschool/static/
```

### Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
journalctl -u nginx -n 50
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:

```nginx
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### 2. –°–∂–∞—Ç–∏–µ

```nginx
# –í –±–ª–æ–∫–µ server –¥–æ–±–∞–≤—å—Ç–µ:
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É –≤–∞—Å –±—É–¥–µ—Ç:
- ‚úÖ Nginx –∫–∞–∫ reverse proxy
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ SSL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í–∞—à —Å–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: **http://158.160.28.235:8000** üöÄ
